<h1>Tickets</h1>

<div>
    <% if user_signed_in? %>
    Logged in as <strong><%= current_user.email %></strong>.
    <%= link_to "Logout", destroy_user_session_path, method: :delete %>
    <%= link_to "My Tickets", bookings_path %>
    <% else %>
    <%= link_to "Sign up", new_user_registration_path%> |
    <%= link_to "Login", new_user_session_path%>
    <% end %>
</div>

<table>
    <thead>
        <tr>
            <th>Company</th>
            <th>Departure</th>
            <th>From</th>
            <th>To</th>
            <th>Available tickets</th>
            <th colspan="3"></th>
        </tr>
    </thead>

    <tbody>
        <% @tickets.each do |ticket| %>
        <tr>
            <td><%= ticket.company %></td>
            <td><%= ticket.departure.to_formatted_s(:long)    %></td>
            <td><%= ticket.from %></td>
            <td><%= ticket.to %></td>
            <% num_available =  ticket.num_max - @bookings.where(ticket_id: ticket.id).length %>
            <td><%= num_available  %></td>
            <% if num_available > 0 %>
            <td><%= link_to 'Buy', new_ticket_booking_path(ticket) %></td>
            <% else  %>
            <td>No more available tickets</td>
            <% end %>
        </tr>
        <% end %>
    </tbody>
</table>

<br>